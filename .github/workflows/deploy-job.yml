name: Deploy buy runner

on:
  push:
    branches: [ "main", "dev"]

jobs:
  deploy:
    runs-on: self-hosted # Запускаем на раннере, который настроили до этого.
    steps:
      - name: checkout repo
        uses: actions/checkout@v3
      - name: docker compose build
        run: docker compose build
        env:
          POSTGRES_USER: ${{ secrets.POSTGRES_USER }}
          POSTGRES_PASSWORD: ${{ secrets.POSTGRES_PASSWORD }}
          POSTGRES_DB: ${{ secrets.POSTGRES_DB }}
          PGADMIN_DEFAULT_EMAIL: ${{ secrets.PGADMIN_DEFAULT_EMAIL }}
          PGADMIN_DEFAULT_PASSWORD: ${{ secrets.PGADMIN_DEFAULT_PASSWORD }}
          SECRET_KEY: ${{ secrets.SECRET_KEY }}
      - name: docker compose up
        run: docker compose up -d
